{"version":3,"sources":["../../src/controllers/posts.js"],"names":["PostController","database","list","req","res","posts","findAll","status","httpStatus","OK","json","content","console","log","INTERNAL_SERVER_ERROR","error","stack","index","id","params","findByPk","post","remove","BAD_REQUEST","destroy","where","flag","photo","fs","unlink","path","join","__dirname","err","insert","newPost","body","profile_pic","file","filename","create","edit","oldData","msg","update","newData","CREATED"],"mappings":"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","sourcesContent":["import httpStatus from 'http-status';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n\r\nconst PostController = database => ({\r\n    list: async (req, res) => {\r\n        try {\r\n            const { posts } = database;\r\n\r\n            const list = await posts.findAll();\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: true,\r\n                    content: list \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    index: async (req, res) => {\r\n        try {\r\n            const { posts } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const post = await posts.findByPk(id);\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: post !== null,\r\n                    content: post \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    remove: async (req, res) => {\r\n        try {\r\n            const { posts } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const post = await posts.findByPk(id);\r\n\r\n            if (post === null) \r\n                return res\r\n                        .status(httpStatus.BAD_REQUEST)\r\n                        .json({\r\n                            status: false,\r\n                            content: {}\r\n                        });\r\n\r\n            const flag = await posts.destroy({ where: { id }});\r\n            if (post.photo !== null && post.photo !== \"\") {\r\n                fs.unlink(\r\n                    path.join(__dirname, '..', 'uploads', post.photo),\r\n                    err => {\r\n                        if (err) console.error(err.stack);\r\n                    }\r\n                );\r\n            }\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: flag === 1,\r\n                    content: post \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    insert: async (req, res) => {\r\n        try {\r\n            const { posts } = database;\r\n\r\n            let newPost = { \r\n                ...req.body,\r\n                profile_pic: req.file ? req.file.filename : ''\r\n             }\r\n\r\n            const post = await posts.create(newPost);\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: true,\r\n                    content: post \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    edit: async (req, res) => {\r\n        try {\r\n            const { posts } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const oldData = await posts.findByPk(id);\r\n            if (oldData === null)\r\n                return res\r\n                    .status(httpStatus.BAD_REQUEST)\r\n                    .json({\r\n                        status: false,\r\n                        msg: 'Instance not found.'\r\n                    });\r\n            \r\n            if (req.file) {\r\n                if (oldData.photo !== null && \r\n                    oldData.photo !== \"\") {\r\n                    fs.unlink(  \r\n                        path.join(__dirname, '..', 'uploads',\r\n                        oldData.photo),\r\n                        err => {\r\n                            if (err) console.error(err.stack);\r\n                        }\r\n                    );\r\n                }\r\n            }\r\n\r\n            const [ flag ] = await posts.update({\r\n                ...oldData,\r\n                ...req.body,\r\n                photo: req.file ? req.file.filename : oldData.photo\r\n            }, { where: req.params });\r\n\r\n            const newData = await posts.findByPk(id);\r\n            return res\r\n                    .status(httpStatus.CREATED)\r\n                    .json({\r\n                        status: flag === 1,\r\n                        content: newData\r\n                    });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n});\r\n\r\nexport default PostController;\r\n"],"file":"posts.js"}