{"version":3,"sources":["../../src/controllers/users.js"],"names":["UserController","database","list","req","res","users","graduations","findAll","include","model","status","httpStatus","OK","json","content","console","log","INTERNAL_SERVER_ERROR","error","stack","index","id","params","findByPk","user","remove","BAD_REQUEST","destroy","where","flag","photo","fs","unlink","path","join","__dirname","err","insert","newUser","body","profile_pic","file","filename","create","edit","oldData","msg","update","newData","CREATED"],"mappings":"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","sourcesContent":["import httpStatus from 'http-status';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n\r\nconst UserController = database => ({\r\n    list: async (req, res) => {\r\n        try {\r\n            const { users, graduations } = database;\r\n\r\n            const list = await users.findAll({\r\n                include: [{\r\n                        model: graduations\r\n                    }]\r\n            });\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: true,\r\n                    content: list \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    index: async (req, res) => {\r\n        try {\r\n            const { users, graduations } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const user = await users.findByPk(id, {\r\n                include: [{\r\n                        model: graduations\r\n                    }]\r\n            });\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: user !== null,\r\n                    content: user \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    remove: async (req, res) => {\r\n        try {\r\n            const { users } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const user = await users.findByPk(id);\r\n\r\n            if (user === null) \r\n                return res\r\n                        .status(httpStatus.BAD_REQUEST)\r\n                        .json({\r\n                            status: false,\r\n                            content: {}\r\n                        });\r\n\r\n            const flag = await users.destroy({ where: { id }});\r\n            if (user.photo !== null && user.photo !== \"\") {\r\n                fs.unlink(\r\n                    path.join(__dirname, '..', 'uploads', user.photo),\r\n                    err => {\r\n                        if (err) console.error(err.stack);\r\n                    }\r\n                );\r\n            }\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: flag === 1,\r\n                    content: user \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    insert: async (req, res) => {\r\n        try {\r\n            const { users } = database;\r\n\r\n            let newUser = { \r\n                ...req.body,\r\n                profile_pic: req.file ? req.file.filename : ''\r\n             }\r\n\r\n            const user = await users.create(newUser);\r\n\r\n            return res\r\n                .status(httpStatus.OK)\r\n                .json({\r\n                    status: true,\r\n                    content: user \r\n                });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n    edit: async (req, res) => {\r\n        try {\r\n            const { users } = database;\r\n\r\n            const { id } = req.params;\r\n\r\n            const oldData = await users.findByPk(id);\r\n            if (oldData === null)\r\n                return res\r\n                    .status(httpStatus.BAD_REQUEST)\r\n                    .json({\r\n                        status: false,\r\n                        msg: 'Instance not found.'\r\n                    });\r\n            \r\n            if (req.file) {\r\n                if (oldData.photo !== null && \r\n                    oldData.photo !== \"\") {\r\n                    fs.unlink(  \r\n                        path.join(__dirname, '..', 'uploads',\r\n                        oldData.photo),\r\n                        err => {\r\n                            if (err) console.error(err.stack);\r\n                        }\r\n                    );\r\n                }\r\n            }\r\n\r\n            const [ flag ] = await users.update({\r\n                ...oldData,\r\n                ...req.body,\r\n                photo: req.file ? req.file.filename : oldData.photo\r\n            }, { where: req.params });\r\n\r\n            const newData = await users.findByPk(id);\r\n            return res\r\n                    .status(httpStatus.CREATED)\r\n                    .json({\r\n                        status: flag === 1,\r\n                        content: newData\r\n                    });\r\n        } catch (err) {\r\n            console.log(err);\r\n            return res\r\n                .status(httpStatus.INTERNAL_SERVER_ERROR)\r\n                .json({\r\n                    status: false,\r\n                    error: err.stack\r\n                });\r\n        }\r\n    },\r\n});\r\n\r\nexport default UserController;\r\n"],"file":"users.js"}